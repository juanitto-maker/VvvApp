<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VvvebJs Diagnostics</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-item {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
        .warning { background-color: #fff3cd; color: #856404; }
        .status { font-weight: bold; }
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #results { margin-top: 20px; }
    </style>
</head>
<body>
    <h1>VvvebJs Deployment Diagnostics</h1>
    <p>Click the button below to test your VvvebJs deployment:</p>
    
    <button onclick="runDiagnostics()">Run Diagnostics</button>
    
    <div id="results"></div>

    <script>
        async function runDiagnostics() {
            const results = document.getElementById('results');
            results.innerHTML = '<h3>Running diagnostics...</h3>';
            
            const tests = [
                {
                    name: 'Bootstrap CSS',
                    test: () => checkFileExists('css/editor.css')
                },
                {
                    name: 'Bootstrap JS',
                    test: () => checkFileExists('js/bootstrap.min.js')
                },
                {
                    name: 'Popper.js',
                    test: () => checkFileExists('js/popper.min.js')
                },
                {
                    name: 'Mobile Drag Drop',
                    test: () => checkFileExists('js/mobile-drag-drop.js')
                },
                {
                    name: 'VvvebJs Builder Core',
                    test: () => checkFileExists('libs/builder/builder.js')
                },
                {
                    name: 'VvvebJs Components',
                    test: () => checkFileExists('libs/builder/components-bootstrap5.js')
                },
                {
                    name: 'Demo Sections',
                    test: () => checkFileExists('demo/landing/sections/sections.js')
                },
                {
                    name: 'Demo Index',
                    test: () => checkFileExists('demo/landing/index.html')
                },
                {
                    name: 'Save API',
                    test: () => testSaveAPI()
                },
                {
                    name: 'Touch Device Detection',
                    test: () => testTouchDevice()
                }
            ];

            let html = '<h3>Diagnostic Results:</h3>';
            
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const status = result ? 'success' : 'error';
                    const statusText = result ? '✅ OK' : '❌ FAIL';
                    html += `<div class="test-item ${status}">
                        <span>${test.name}</span>
                        <span class="status">${statusText}</span>
                    </div>`;
                } catch (error) {
                    html += `<div class="test-item error">
                        <span>${test.name}</span>
                        <span class="status">❌ ERROR: ${error.message}</span>
                    </div>`;
                }
            }

            // Add recommendations
            html += '<h3>Recommendations:</h3>';
            html += '<div class="test-item warning">Upload missing files to your Vercel deployment</div>';
            html += '<div class="test-item warning">Check browser console for JavaScript errors</div>';
            html += '<div class="test-item warning">Verify all file paths are correct</div>';

            results.innerHTML = html;
        }

        async function checkFileExists(path) {
            try {
                const response = await fetch(path, { method: 'HEAD' });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        async function testSaveAPI() {
            try {
                const response = await fetch('/api/save.js', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'test' })
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        function testTouchDevice() {
            return 'ontouchstart' in window || navigator.maxTouchPoints > 0;
        }
    </script>
</body>
</html>
